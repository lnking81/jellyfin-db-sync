[tox]
envlist = lint,type,test
isolated_build = true
skip_missing_interpreters = true

[testenv]
description = Run pytest tests with coverage
usedevelop = true
setenv =
    FORCE_COLOR = 1
    PY_COLORS = 1
    TERM = xterm-256color
deps =
    pytest>=8.0.0
    pytest-asyncio>=0.24.0
    pytest-cov>=6.0.0
commands =
    pytest --color=yes --cov=src/jellyfin_db_sync --cov-report=term-missing --cov-report=xml {posargs:-v}

[testenv:lint]
description = Run linters (ruff check and format)
skip_install = true
setenv =
    FORCE_COLOR = 1
deps =
    ruff>=0.8.0
commands =
    ruff check {posargs:.}
    ruff format --check {posargs:.}

[testenv:type]
description = Run type checking (mypy)
setenv =
    FORCE_COLOR = 1
    MYPY_FORCE_COLOR = 1
deps =
    mypy>=1.13.0
    types-PyYAML>=6.0.0
commands =
    mypy src/

[testenv:format]
description = Format code with ruff
skip_install = true
setenv =
    FORCE_COLOR = 1
deps =
    ruff>=0.8.0
commands =
    ruff format {posargs:.}
    ruff check --fix {posargs:.}

[testenv:all]
description = Run all checks (lint + type + test with coverage)
setenv =
    FORCE_COLOR = 1
    MYPY_FORCE_COLOR = 1
    TERM = xterm-256color
deps =
    {[testenv]deps}
    {[testenv:lint]deps}
    {[testenv:type]deps}
commands =
    ruff check .
    ruff format --check .
    mypy src/
    pytest --color=yes --cov=jellyfin_db_sync --cov-report=term-missing -v
