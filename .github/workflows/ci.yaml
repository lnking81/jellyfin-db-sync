name: CI

on:
  push:
    branches: [master]
  pull_request:
    branches: [master]

jobs:
  # Call reusable test workflow
  test:
    uses: ./.github/workflows/test.yaml

  # Build Docker image on push to master (after tests pass)
  build:
    needs: [test]
    if: github.event_name == 'push'
    uses: ./.github/workflows/build.yaml
    permissions:
      contents: read
      packages: write
    with:
      push: true
      tags: |
        type=raw,value=latest
        type=sha
